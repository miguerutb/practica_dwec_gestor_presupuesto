<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Gestor de Presupuesto - Miguel Trascasas Baños</title>
    <link rel="stylesheet" type="text/css" href="css/estilos.css" />
  </head>

  <body>
    <div id="aplicacion">
      <div id="controlesprincipales">
        <button type="button" id="actualizarpresupuesto">
          Actualizar presupuesto
        </button>
        <button type="button" id="anyadirgasto">Añadir gasto</button>
      </div>
      <div id="presupuesto"></div>

      <div id="gastos-totales"></div>

      <div id="balance-total"></div>

      <div id="listado-gastos-completo"></div>

      <div id="listado-gastos-filtrado-1"></div>

      <div id="listado-gastos-filtrado-2"></div>

      <div id="listado-gastos-filtrado-3"></div>

      <div id="listado-gastos-filtrado-4"></div>

      <div id="agrupacion-dia"></div>

      <div id="agrupacion-mes"></div>

      <div id="agrupacion-anyo"></div>
    </div>

    <script type="module" src="/js/generarDatosEstaticos.js"></script>
    <script type="module">
      import * as gp from "/js/gestionPresupuestoWeb.js";

      // funcion para que se ejecute cuando llegue aqui y la pueda llamar cuando quiera
      function anyadirEventos() {
        const actualizar = document.getElementById("actualizarpresupuesto");
        actualizar.addEventListener("click", gp.actualizarPresupuestoWeb);

        const anyadir = document.getElementById("anyadirgasto");
        anyadir.addEventListener("click", gp.nuevoGastoWeb);

        // añadimos evento al botón Editar Gastos

        const bEditarGastos = document.getElementsByClassName("gasto-editar");

        for (const bEditar of bEditarGastos) {
          // Cada boton tiene que tener su instancia
          const objetoEditar = new gp.EditarHandle();

          // Traemos el gasto del padre del boton, que es quien tiene la info
          objetoEditar.gasto = bEditar.parentNode.gasto;

          bEditar.addEventListener("click", objetoEditar);
        }

        // Añadimos evento al botón Borrar Gastos

        const bBorrarGastos = document.getElementsByClassName("gasto-borrar");

        for (const bBorrar of bBorrarGastos) {
          // Cada boton tiene que tener su instancia
          const objetoBorrar = new gp.BorrarHandle();

          // Traemos el gasto del padre del boton, que es quien tiene la info
          objetoBorrar.gasto = bBorrar.parentNode.gasto;

          bBorrar.addEventListener("click", objetoBorrar);
        }

        // Añadimos evento al span de etiquetas

        const sEtiquetas = document.getElementsByClassName(
          "gasto-etiquetas-etiqueta"
        );

        for (const sEtiqueta of sEtiquetas) {
          const objBorrarEtiqueta = new gp.BorrarEtiquetasHandle();

          objBorrarEtiqueta.gasto = sEtiqueta.parentNode.parentNode.gasto;
          objBorrarEtiqueta.etiqueta = sEtiqueta.innerHTML;

          sEtiqueta.addEventListener("click", objBorrarEtiqueta);
        }
      }

      anyadirEventos();

      // añadir evento a la aplicacion para que cuando se modifique el contenido, le podamos volver a poner eventos
      const app = document.getElementById("aplicacion");

      // si pongo console.log dentro se ejecuta 9 veces -> ¿Por qué? ¿Hay forma más eficiente?
      app.addEventListener("DOMNodeInserted", (event) => {
        anyadirEventos();
      });
    </script>
  </body>
</html>
